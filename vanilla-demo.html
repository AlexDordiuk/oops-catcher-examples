<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ü™∞ Oops Catcher - Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      max-width: 600px;
      width: 100%;
      padding: 40px;
    }

    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      color: white;
      text-decoration: none;
      font-size: 14px;
      opacity: 0.9;
      transition: opacity 0.2s;
    }

    .back-link:hover {
      opacity: 1;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .logo {
      font-size: 48px;
      margin-bottom: 10px;
    }

    h1 {
      color: #1e3a8a;
      margin-bottom: 8px;
      font-size: 32px;
    }

    .subtitle {
      color: #666;
      font-size: 14px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 500;
      font-size: 14px;
    }

    input, textarea, select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      transition: border-color 0.3s;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #7c3aed;
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    .btn-primary {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(124, 58, 237, 0.4);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .demo-actions {
      margin-top: 30px;
      padding-top: 30px;
      border-top: 2px solid #eee;
    }

    .demo-actions h3 {
      color: #333;
      margin-bottom: 15px;
      font-size: 16px;
    }

    .btn-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn-secondary {
      padding: 10px 16px;
      background: #f5f5f5;
      color: #333;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
      border-color: #ccc;
    }

    .custom-field-row button {
      min-width: 40px;
    }

    .info-panel {
      margin-top: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #7c3aed;
    }

    .info-panel h4 {
      color: #7c3aed;
      margin-bottom: 10px;
      font-size: 14px;
    }

    .info-panel pre {
      background: #fff;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
      color: #333;
      max-height: 300px;
      overflow-y: auto;
    }

    .console-errors {
      margin-top: 10px;
      max-height: 200px;
      overflow-y: auto;
    }

    .error-item {
      background: #fff;
      padding: 8px;
      margin-bottom: 5px;
      border-radius: 4px;
      font-size: 12px;
      border-left: 3px solid #e74c3c;
    }

    .error-item .error-message {
      color: #e74c3c;
      font-weight: 600;
    }

    .error-item .error-time {
      color: #999;
      font-size: 11px;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      display: none;
      animation: slideIn 0.3s ease;
      z-index: 1000;
    }

    .notification.show {
      display: block;
    }

    .notification.success {
      border-left: 4px solid #27ae60;
    }

    .notification.error {
      border-left: 4px solid #e74c3c;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="index.html" class="back-link">‚Üê Back to Examples</a>
    <div class="header">
      <div class="logo">ü™∞</div>
      <h1>Oops Catcher</h1>
      <p class="subtitle">Catch errors and user feedback in one click</p>
    </div>

    <!-- User Report Form -->
    <form id="report-form">
      <div class="form-group">
        <label for="report-message">What happened?</label>
        <input type="text" id="report-message" placeholder="Describe the issue..." required>
      </div>

      <div class="form-group">
        <label for="report-description">Details (optional)</label>
        <textarea id="report-description" placeholder="Any additional information..."></textarea>
      </div>

      <div class="form-group">
        <label for="report-category">Category</label>
        <select id="report-category">
          <option value="bug">Bug</option>
          <option value="feedback">Feedback</option>
          <option value="question">Question</option>
          <option value="other">Other</option>
        </select>
      </div>

      <div class="form-group">
        <label>Custom Fields (optional)</label>
        <div id="custom-fields-container">
          <div class="custom-field-row" style="display: flex; gap: 10px; margin-bottom: 10px;">
            <input type="text" placeholder="Key (e.g., orderId)" class="custom-key" style="flex: 1;">
            <input type="text" placeholder="Value (e.g., ORD-123)" class="custom-value" style="flex: 1;">
          </div>
        </div>
        <button type="button" class="btn-secondary" onclick="addCustomField()" style="margin-top: 10px;">
          + Add Field
        </button>
        <small style="color: #666; font-size: 12px; margin-top: 8px; display: block;">
          Add custom data like: orderId=ORD-123, userId=user_456, amount=99.99
        </small>
      </div>

      <button type="submit" class="btn-primary">Send Report</button>
    </form>

    <!-- Demo Actions -->
    <div class="demo-actions">
      <h3>üß™ Demo Actions</h3>
      <div class="btn-group">
        <button class="btn-secondary" onclick="triggerError()">Trigger Error</button>
        <button class="btn-secondary" onclick="testCatch()">Test catch()</button>
        <button class="btn-secondary" onclick="showSystemInfo()">System Info</button>
        <button class="btn-secondary" onclick="showConsoleErrors()">Console Logs</button>
        <button class="btn-secondary" onclick="clearErrors()">Clear Logs</button>
      </div>

      <div id="info-display"></div>
    </div>
  </div>

  <div class="notification" id="notification"></div>

  <script type="module">
    // Simulated Oops class for demo purposes
    class OopsDemo {
      constructor(config) {
        this.config = config;
        this.consoleErrors = [];
        this.maxErrors = config.maxConsoleErrors || 20;

        if (config.captureConsole) {
          this.startConsoleCapture();
        }
      }

      startConsoleCapture() {
        const originalError = console.error;
        const self = this;

        console.error = function(...args) {
          const formattedMessage = args.map(arg => {
            if (typeof arg === 'object' && arg !== null) {
              try {
                return JSON.stringify(arg, null, 2);
              } catch (e) {
                return String(arg);
              }
            }
            return String(arg);
          }).join(' ');

          self.consoleErrors.push({
            message: formattedMessage,
            timestamp: new Date().toISOString(),
            type: 'error',
            stack: new Error().stack
          });

          if (self.consoleErrors.length > self.maxErrors) {
            self.consoleErrors.shift();
          }

          originalError.apply(console, args);
        };
      }

      getSystemInfo() {
        return {
          browser: this.detectBrowser(),
          userAgent: navigator.userAgent,
          platform: navigator.platform,
          language: navigator.language,
          screenResolution: `${window.screen.width}x${window.screen.height}`,
          viewport: `${window.innerWidth}x${window.innerHeight}`,
          timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
          online: navigator.onLine,
          cookiesEnabled: navigator.cookieEnabled,
          memory: navigator.deviceMemory ? `${navigator.deviceMemory} GB` : 'unknown',
          cores: navigator.hardwareConcurrency || 'unknown',
          touchSupport: navigator.maxTouchPoints > 0,
          colorDepth: `${window.screen.colorDepth}-bit`,
          pixelRatio: window.devicePixelRatio
        };
      }

      detectBrowser() {
        const ua = navigator.userAgent;
        if (ua.includes('Chrome')) return 'Chrome';
        if (ua.includes('Safari')) return 'Safari';
        if (ua.includes('Firefox')) return 'Firefox';
        if (ua.includes('Edge')) return 'Edge';
        return 'Unknown';
      }

      getConsoleErrors() {
        return this.consoleErrors;
      }

      clearConsoleErrors() {
        this.consoleErrors = [];
      }

      catch(error) {
        const errorMessage = typeof error === 'string' ? error : error.message;
        const errorStack = typeof error === 'string' ? undefined : error.stack;

        this.consoleErrors.push({
          message: errorMessage,
          stack: errorStack,
          timestamp: new Date().toISOString(),
          type: 'error'
        });

        return this.generateReport();
      }

      async report(userReport) {
        // Only include system info and console errors for bugs
        const isBugReport = userReport.category === 'bug' || userReport.severity !== undefined;

        const report = {
          userReport,
          systemInfo: isBugReport ? this.getSystemInfo() : null,
          consoleErrors: isBugReport ? this.getConsoleErrors() : undefined,
          userId: this.config.userId,
          userEmail: this.config.userEmail,
          metadata: this.config.metadata,
          timestamp: new Date().toISOString()
        };

        return this.submit(report);
      }

      generateReport(userReport) {
        // Only include system info and console errors for bugs
        const isBugReport = !userReport || userReport.category === 'bug' || userReport.severity !== undefined;

        return {
          userReport,
          systemInfo: isBugReport ? this.getSystemInfo() : null,
          consoleErrors: isBugReport ? this.getConsoleErrors() : undefined,
          userId: this.config.userId,
          userEmail: this.config.userEmail,
          metadata: this.config.metadata,
          timestamp: new Date().toISOString()
        };
      }

      async submit(report) {
        console.group('üì§ Submitting Report');
        console.log('Full Report:', JSON.stringify(report, null, 2));
        console.log('User Report with custom fields:', report.userReport);
        console.groupEnd();

        // Simulate API call
        await new Promise(resolve => setTimeout(resolve, 500));

        return {
          success: true,
          message: 'Report submitted successfully',
          id: 'oops-' + Date.now()
        };
      }
    }

    // Initialize Oops
    window.Oops = new OopsDemo({
      endpoint: '/api/feedback',
      captureConsole: true,
      maxConsoleErrors: 20,
      userId: 'demo-user',
      userEmail: 'demo@example.com',
      metadata: {
        appVersion: '1.0.0',
        environment: 'demo'
      }
    });

    // Add custom field row
    window.addCustomField = function() {
      const container = document.getElementById('custom-fields-container');
      const newRow = document.createElement('div');
      newRow.className = 'custom-field-row';
      newRow.style.cssText = 'display: flex; gap: 10px; margin-bottom: 10px;';
      newRow.innerHTML = `
        <input type="text" placeholder="Key" class="custom-key" style="flex: 1;">
        <input type="text" placeholder="Value" class="custom-value" style="flex: 1;">
        <button type="button" onclick="this.parentElement.remove()" class="btn-secondary" style="padding: 10px 16px;">√ó</button>
      `;
      container.appendChild(newRow);
    };

    // Report form submission
    document.getElementById('report-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const userReport = {
        message: document.getElementById('report-message').value,
        description: document.getElementById('report-description').value || undefined,
        category: document.getElementById('report-category').value
      };

      // Collect custom fields
      const customFieldRows = document.querySelectorAll('.custom-field-row');
      const customFields = {};
      let hasCustomFields = false;

      customFieldRows.forEach(row => {
        const key = row.querySelector('.custom-key').value.trim();
        const value = row.querySelector('.custom-value').value.trim();
        if (key && value) {
          customFields[key] = value;
          hasCustomFields = true;
        }
      });

      // Add custom fields to report if any exist
      if (hasCustomFields) {
        userReport.custom = customFields;
      }

      const result = await window.Oops.report(userReport);

      if (result.success) {
        // Show success notification with details
        showNotification('‚úÖ Report sent!', 'success');

        // Show what was sent in the info panel
        const display = document.getElementById('info-display');
        const isBugReport = userReport.category === 'bug' || userReport.severity !== undefined;

        display.innerHTML = `
          <div class="info-panel">
            <h4>‚úÖ Report Sent Successfully!</h4>
            <pre>${JSON.stringify({
              userReport,
              systemInfoIncluded: isBugReport,
              consoleErrorsIncluded: isBugReport
            }, null, 2)}</pre>
          </div>
        `;

        e.target.reset();
      } else {
        showNotification('‚ùå Failed to send', 'error');
      }
    });

    // Helper functions
    window.triggerError = function() {
      console.error('Demo error: Something went wrong!', { code: 500, timestamp: Date.now() });
      showNotification('üêõ Error triggered and captured!', 'success');
    };

    window.testCatch = function() {
      try {
        throw new Error('Test error from catch block');
      } catch (error) {
        const report = window.Oops.catch(error);
        console.log('Caught error, report generated:', report);
        showNotification('‚úÖ Error caught! Check console logs.', 'success');
      }
    };

    window.showSystemInfo = function() {
      const info = window.Oops.getSystemInfo();
      const display = document.getElementById('info-display');
      display.innerHTML = `
        <div class="info-panel">
          <h4>üìä System Information</h4>
          <pre>${JSON.stringify(info, null, 2)}</pre>
        </div>
      `;
    };

    window.showConsoleErrors = function() {
      const errors = window.Oops.getConsoleErrors();
      const display = document.getElementById('info-display');

      if (errors.length === 0) {
        display.innerHTML = `
          <div class="info-panel">
            <h4>üìù Captured Console Logs</h4>
            <p>No errors captured yet. Click "Trigger Error" to test.</p>
          </div>
        `;
        return;
      }

      const errorsHtml = errors.map(err => `
        <div class="error-item">
          <div class="error-message">${err.message}</div>
          <div class="error-time">${new Date(err.timestamp).toLocaleString()}</div>
        </div>
      `).join('');

      display.innerHTML = `
        <div class="info-panel">
          <h4>üìù Captured Console Logs (${errors.length})</h4>
          <div class="console-errors">
            ${errorsHtml}
          </div>
        </div>
      `;
    };

    window.clearErrors = function() {
      window.Oops.clearConsoleErrors();
      document.getElementById('info-display').innerHTML = '';
      showNotification('üßπ Console logs cleared!', 'success');
    };

    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${type} show`;

      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }
  </script>
</body>
</html>
